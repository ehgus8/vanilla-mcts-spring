{{>layouts/header}}
<div class="container">
    <div class="row g-0 justify-content-center custom-row bg-primary">
        <div class="col fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">
            </div>
        </div>
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
    </div>
    <div class="row g-0 justify-content-center custom-row bg-primary">
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
    </div>
    <div class="row g-0 justify-content-center custom-row bg-primary">
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
        <div class="col
            fixed-col">
            <div class="cell bg-secondary-subtle d-flex
            justify-content-center align-items-center border border-dark">

            </div>
        </div>
    </div>
</div>
<script>
    function getY(index) {
        return Math.trunc(index / 3);
    }

    function getX(index) {
        return index % 3;
    }
    function updateCells(cells) {
        cells.forEach((c, index) => {
            if(board[getY(index)][getX(index)] == 1) {
                c.textContent = 'O';
            } else if(board[getY(index)][getX(index)] == -1) {
                c.textContent = 'X';
            }
        });
    }
    const cells = document.querySelectorAll(".cell");
    let board = [
      [0, 0, 0],
      [0, 0, 0],
      [0, 0, 0]
    ];

    const currentPlayer = 1;
    let moveCount = 0;
    cells.forEach((c, index) => {
        c.addEventListener("click", () => {
            console.log(`${index}번째 버튼 클릭함!`);
            if(c.textContent.trim() !== '') {
                return
            }
            moveCount++;
            board[getY(index)][getX(index)] = currentPlayer;
            updateCells(cells);

            if(moveCount < 9) {
                fetch("/api/play/tictactoe", {
                    method: "POST",
                    headers: {"Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        board,
                        y: getY(index),
                        x: getX(index),
                        prevPlayer: currentPlayer,
                        moveCount,
                        result: -1
                    })
                }).then(response => {
                    console.log(response);
                    return response.json();
                }).then(data => {
                    console.log(data);
                    board = data.board;
                    moveCount = data.moveCount;
                    updateCells(cells);
                });
            }
        });
    });
</script>
{{>layouts/footer}}